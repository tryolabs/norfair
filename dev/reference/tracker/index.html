
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../img/icon.svg">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.4.1">
    
    
      
        <title>Tracker - Norfair</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tracker" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Norfair" class="md-header__button md-logo" aria-label="Norfair" data-md-component="logo">
      
  <img src="../../img/logo-dark.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Norfair
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Tracker
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/tryolabs/norfair" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tryolabs/norfair
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Norfair" class="md-nav__button md-logo" aria-label="Norfair" data-md-component="logo">
      
  <img src="../../img/logo-dark.svg" alt="logo">

    </a>
    Norfair
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/tryolabs/norfair" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tryolabs/norfair
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Tracker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Tracker
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#norfair.tracker" class="md-nav__link">
    tracker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.tracker.Tracker" class="md-nav__link">
    Tracker
  </a>
  
    <nav class="md-nav" aria-label="Tracker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.Tracker.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.Tracker.current_object_count" class="md-nav__link">
    current_object_count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.Tracker.total_object_count" class="md-nav__link">
    total_object_count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.Tracker.get_active_objects" class="md-nav__link">
    get_active_objects()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.Tracker.match_dets_and_objs" class="md-nav__link">
    match_dets_and_objs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.tracker.TrackedObject" class="md-nav__link">
    TrackedObject
  </a>
  
    <nav class="md-nav" aria-label="TrackedObject">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.TrackedObject.hit" class="md-nav__link">
    hit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.TrackedObject.merge" class="md-nav__link">
    merge()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.tracker.Detection" class="md-nav__link">
    Detection
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../drawing/" class="md-nav__link">
        Drawing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../video/" class="md-nav__link">
        Video
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../distances/" class="md-nav__link">
        Distances
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../camera_motion/" class="md-nav__link">
        Camera Motion
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../filter/" class="md-nav__link">
        Filter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#norfair.tracker" class="md-nav__link">
    tracker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.tracker.Tracker" class="md-nav__link">
    Tracker
  </a>
  
    <nav class="md-nav" aria-label="Tracker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.Tracker.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.Tracker.current_object_count" class="md-nav__link">
    current_object_count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.Tracker.total_object_count" class="md-nav__link">
    total_object_count()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.Tracker.get_active_objects" class="md-nav__link">
    get_active_objects()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.Tracker.match_dets_and_objs" class="md-nav__link">
    match_dets_and_objs()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.tracker.TrackedObject" class="md-nav__link">
    TrackedObject
  </a>
  
    <nav class="md-nav" aria-label="TrackedObject">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.TrackedObject.hit" class="md-nav__link">
    hit()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#norfair.tracker.TrackedObject.merge" class="md-nav__link">
    merge()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.tracker.Detection" class="md-nav__link">
    Detection
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="tracker">Tracker<a class="headerlink" href="#tracker" title="Permanent link">#</a></h1>


<div class="doc doc-object doc-module">


<a id="norfair.tracker"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="norfair.tracker.Tracker">
        <code>Tracker</code>


<a class="headerlink" href="#norfair.tracker.Tracker" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">

  
      <p>The class in charge of performing the tracking of the detections produced by a detector.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>distance_function</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[str, <span title="typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="norfair.tracker.Detection" href="#norfair.tracker.Detection">Detection</a>, <a class="autorefs autorefs-internal" title="norfair.tracker.TrackedObject" href="#norfair.tracker.TrackedObject">TrackedObject</a>], float]]</code>
          </td>
          <td><p>Function used by the tracker to determine the distance between newly detected objects and the objects that are currently being tracked.
This function should take 2 input arguments, the first being a <a class="autorefs autorefs-internal" href="#norfair.tracker.Detection">Detection</a>, and the second a <a class="autorefs autorefs-internal" href="#norfair.tracker.TrackedObject">TrackedObject</a>.
It has to return a <code>float</code> with the distance it calculates.
Some common distances are implemented in <a class="autorefs autorefs-internal" href="../distances/#distances">distances</a>, as a shortcut the tracker accepts the name of these <a class="autorefs autorefs-internal" href="../distances/#norfair.distances.get_distance_by_name">predefined distances</a>.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>distance_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Defines what is the maximum distance that can constitute a match.
Detections and tracked objects whose distances are above this threshold won't be matched by the tracker.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>hit_counter_max</code></td>
          <td>
                <code>int, optional</code>
          </td>
          <td><p>Each tracked objects keeps an internal hit counter which tracks how often it's getting matched to a detection,
each time it gets a match this counter goes up, and each time it doesn't it goes down.</p>
<p>If it goes below 0 the object gets destroyed. This argument defines how large this inertia can grow,
and therefore defines how long an object can live without getting matched to any detections, before it is displaced as a dead object, if no ReID distance function is implemented it will be destroyed.</p></td>
          <td>
                <code>15</code>
          </td>
        </tr>
        <tr>
          <td><code>initialization_delay</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[int], optional</code>
          </td>
          <td><p>Determines how large the object's hit counter must be in order to be considered as initialized, and get returned to the user as a real object.
It must be smaller than <code>hit_counter_max</code> or otherwise the object would never be initialized.</p>
<p>If set to 0, objects will get returned to the user as soon as they are detected for the first time,
which can be problematic as this can result in objects appearing and immediately dissapearing.</p>
<p>Defaults to <code>hit_counter_max / 2</code></p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>pointwise_hit_counter_max</code></td>
          <td>
                <code>int, optional</code>
          </td>
          <td><p>Each tracked object keeps track of how often the points it's tracking have been getting matched.
Points that are getting matched (<code>pointwise_hit_counter &gt; 0</code>) are said to be live, and points which aren't (<code>pointwise_hit_counter = 0</code>)
are said to not be live.</p>
<p>This is used to determine things like which individual points in a tracked object get drawn by <a class="autorefs autorefs-internal" href="../drawing/#norfair.drawing.draw_tracked_objects"><code>draw_tracked_objects</code></a> and which don't.
This argument defines how large the inertia for each point of a tracker can grow.</p></td>
          <td>
                <code>4</code>
          </td>
        </tr>
        <tr>
          <td><code>detection_threshold</code></td>
          <td>
                <code>float, optional</code>
          </td>
          <td><p>Sets the threshold at which the scores of the points in a detection being fed into the tracker must dip below to be ignored by the tracker.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>filter_factory</code></td>
          <td>
                <code><span title="norfair.filter.FilterFactory">FilterFactory</span>, optional</code>
          </td>
          <td><p>This parameter can be used to change what filter the <a class="autorefs autorefs-internal" href="#norfair.tracker.TrackedObject"><code>TrackedObject</code></a> instances created by the tracker will use.
Defaults to <a class="autorefs autorefs-internal" href="../filter/#norfair.filter.OptimizedKalmanFilterFactory"><code>OptimizedKalmanFilterFactory()</code></a></p></td>
          <td>
                <code>OptimizedKalmanFilterFactory()</code>
          </td>
        </tr>
        <tr>
          <td><code>past_detections_length</code></td>
          <td>
                <code>int, optional</code>
          </td>
          <td><p>How many past detections to save for each tracked object.
Norfair tries to distribute these past detections uniformly through the object's lifetime so they're more representative.
Very useful if you want to add metric learning to your model, as you can associate an embedding to each detection and access them in your distance function.</p></td>
          <td>
                <code>4</code>
          </td>
        </tr>
        <tr>
          <td><code>reid_distance_function</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>[[<a class="autorefs autorefs-internal" title="norfair.tracker.TrackedObject" href="#norfair.tracker.TrackedObject">TrackedObject</a>, <a class="autorefs autorefs-internal" title="norfair.tracker.TrackedObject" href="#norfair.tracker.TrackedObject">TrackedObject</a>], float]]</code>
          </td>
          <td><p>Function used by the tracker to determine the ReID distance between newly detected trackers and unmatched trackers by the distance function.</p>
<p>This function should take 2 input arguments, the first being tracked objects in the initialization phase of type <a class="autorefs autorefs-internal" href="#norfair.tracker.TrackedObject"><code>TrackedObject</code></a>,
and the second being tracked objects that have been unmatched of type <a class="autorefs autorefs-internal" href="#norfair.tracker.TrackedObject"><code>TrackedObject</code></a>. It returns a <code>float</code> with the distance it
calculates.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>reid_distance_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Defines what is the maximum ReID distance that can constitute a match.</p>
<p>Tracked objects whose distance is above this threshold won't be merged, if they are the oldest tracked object will be maintained
with the position of the new tracked object.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>reid_hit_counter_max</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[int]</code>
          </td>
          <td><p>Each tracked object keeps an internal ReID hit counter which tracks how often it's getting recognized by another tracker,
each time it gets a match this counter goes up, and each time it doesn't it goes down. If it goes below 0 the object gets destroyed.
If used, this argument (<code>reid_hit_counter_max</code>) defines how long an object can live without getting matched to any detections, before it is destroyed.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>norfair/tracker.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Tracker</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The class in charge of performing the tracking of the detections produced by a detector.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    distance_function : Union[str, Callable[[Detection, TrackedObject], float]]</span>
<span class="sd">        Function used by the tracker to determine the distance between newly detected objects and the objects that are currently being tracked.</span>
<span class="sd">        This function should take 2 input arguments, the first being a [Detection][norfair.tracker.Detection], and the second a [TrackedObject][norfair.tracker.TrackedObject].</span>
<span class="sd">        It has to return a `float` with the distance it calculates.</span>
<span class="sd">        Some common distances are implemented in [distances][], as a shortcut the tracker accepts the name of these [predefined distances][norfair.distances.get_distance_by_name].</span>
<span class="sd">    distance_threshold : float</span>
<span class="sd">        Defines what is the maximum distance that can constitute a match.</span>
<span class="sd">        Detections and tracked objects whose distances are above this threshold won&#39;t be matched by the tracker.</span>
<span class="sd">    hit_counter_max : int, optional</span>
<span class="sd">        Each tracked objects keeps an internal hit counter which tracks how often it&#39;s getting matched to a detection,</span>
<span class="sd">        each time it gets a match this counter goes up, and each time it doesn&#39;t it goes down.</span>

<span class="sd">        If it goes below 0 the object gets destroyed. This argument defines how large this inertia can grow,</span>
<span class="sd">        and therefore defines how long an object can live without getting matched to any detections, before it is displaced as a dead object, if no ReID distance function is implemented it will be destroyed.</span>
<span class="sd">    initialization_delay : Optional[int], optional</span>
<span class="sd">         Determines how large the object&#39;s hit counter must be in order to be considered as initialized, and get returned to the user as a real object.</span>
<span class="sd">         It must be smaller than `hit_counter_max` or otherwise the object would never be initialized.</span>

<span class="sd">         If set to 0, objects will get returned to the user as soon as they are detected for the first time,</span>
<span class="sd">         which can be problematic as this can result in objects appearing and immediately dissapearing.</span>

<span class="sd">         Defaults to `hit_counter_max / 2`</span>
<span class="sd">    pointwise_hit_counter_max : int, optional</span>
<span class="sd">        Each tracked object keeps track of how often the points it&#39;s tracking have been getting matched.</span>
<span class="sd">        Points that are getting matched (`pointwise_hit_counter &gt; 0`) are said to be live, and points which aren&#39;t (`pointwise_hit_counter = 0`)</span>
<span class="sd">        are said to not be live.</span>

<span class="sd">        This is used to determine things like which individual points in a tracked object get drawn by [`draw_tracked_objects`][norfair.drawing.draw_tracked_objects] and which don&#39;t.</span>
<span class="sd">        This argument defines how large the inertia for each point of a tracker can grow.</span>
<span class="sd">    detection_threshold : float, optional</span>
<span class="sd">        Sets the threshold at which the scores of the points in a detection being fed into the tracker must dip below to be ignored by the tracker.</span>
<span class="sd">    filter_factory : FilterFactory, optional</span>
<span class="sd">        This parameter can be used to change what filter the [`TrackedObject`][norfair.tracker.TrackedObject] instances created by the tracker will use.</span>
<span class="sd">        Defaults to [`OptimizedKalmanFilterFactory()`][norfair.filter.OptimizedKalmanFilterFactory]</span>
<span class="sd">    past_detections_length : int, optional</span>
<span class="sd">        How many past detections to save for each tracked object.</span>
<span class="sd">        Norfair tries to distribute these past detections uniformly through the object&#39;s lifetime so they&#39;re more representative.</span>
<span class="sd">        Very useful if you want to add metric learning to your model, as you can associate an embedding to each detection and access them in your distance function.</span>
<span class="sd">    reid_distance_function: Optional[Callable[[&quot;TrackedObject&quot;, &quot;TrackedObject&quot;], float]]</span>
<span class="sd">        Function used by the tracker to determine the ReID distance between newly detected trackers and unmatched trackers by the distance function.</span>

<span class="sd">        This function should take 2 input arguments, the first being tracked objects in the initialization phase of type [`TrackedObject`][norfair.tracker.TrackedObject],</span>
<span class="sd">        and the second being tracked objects that have been unmatched of type [`TrackedObject`][norfair.tracker.TrackedObject]. It returns a `float` with the distance it</span>
<span class="sd">        calculates.</span>
<span class="sd">    reid_distance_threshold: float</span>
<span class="sd">        Defines what is the maximum ReID distance that can constitute a match.</span>

<span class="sd">        Tracked objects whose distance is above this threshold won&#39;t be merged, if they are the oldest tracked object will be maintained</span>
<span class="sd">        with the position of the new tracked object.</span>
<span class="sd">    reid_hit_counter_max: Optional[int]</span>
<span class="sd">        Each tracked object keeps an internal ReID hit counter which tracks how often it&#39;s getting recognized by another tracker,</span>
<span class="sd">        each time it gets a match this counter goes up, and each time it doesn&#39;t it goes down. If it goes below 0 the object gets destroyed.</span>
<span class="sd">        If used, this argument (`reid_hit_counter_max`) defines how long an object can live without getting matched to any detections, before it is destroyed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">distance_function</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">[[</span><span class="s2">&quot;Detection&quot;</span><span class="p">,</span> <span class="s2">&quot;TrackedObject&quot;</span><span class="p">],</span> <span class="nb">float</span><span class="p">]],</span>
        <span class="n">distance_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">hit_counter_max</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
        <span class="n">initialization_delay</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pointwise_hit_counter_max</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">detection_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">filter_factory</span><span class="p">:</span> <span class="n">FilterFactory</span> <span class="o">=</span> <span class="n">OptimizedKalmanFilterFactory</span><span class="p">(),</span>
        <span class="n">past_detections_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
        <span class="n">reid_distance_function</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="s2">&quot;TrackedObject&quot;</span><span class="p">,</span> <span class="s2">&quot;TrackedObject&quot;</span><span class="p">],</span> <span class="nb">float</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">reid_distance_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">reid_hit_counter_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="s2">&quot;TrackedObject&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">distance_function</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">distance_function</span> <span class="o">=</span> <span class="n">get_distance_by_name</span><span class="p">(</span><span class="n">distance_function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_function</span> <span class="o">=</span> <span class="n">distance_function</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter_max</span> <span class="o">=</span> <span class="n">hit_counter_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter_max</span> <span class="o">=</span> <span class="n">reid_hit_counter_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointwise_hit_counter_max</span> <span class="o">=</span> <span class="n">pointwise_hit_counter_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter_factory</span> <span class="o">=</span> <span class="n">filter_factory</span>
        <span class="k">if</span> <span class="n">past_detections_length</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">past_detections_length</span> <span class="o">=</span> <span class="n">past_detections_length</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Argument `past_detections_length` is </span><span class="si">{</span><span class="n">past_detections_length</span><span class="si">}</span><span class="s2"> and should be larger than 0.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">initialization_delay</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialization_delay</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hit_counter_max</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">initialization_delay</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">initialization_delay</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter_max</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Argument &#39;initialization_delay&#39; for &#39;Tracker&#39; class should be an int between 0 and (hit_counter_max = </span><span class="si">{</span><span class="n">hit_counter_max</span><span class="si">}</span><span class="s2">). The selected value is </span><span class="si">{</span><span class="n">initialization_delay</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initialization_delay</span> <span class="o">=</span> <span class="n">initialization_delay</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">distance_threshold</span> <span class="o">=</span> <span class="n">distance_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detection_threshold</span> <span class="o">=</span> <span class="n">detection_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reid_distance_function</span> <span class="o">=</span> <span class="n">reid_distance_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reid_distance_threshold</span> <span class="o">=</span> <span class="n">reid_distance_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obj_factory</span> <span class="o">=</span> <span class="n">_TrackedObjectFactory</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">detections</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Detection&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">period</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">coord_transformations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CoordinatesTransformation</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;TrackedObject&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Process detections found in each frame.</span>

<span class="sd">        The detections can be matched to previous tracked objects or new ones will be created</span>
<span class="sd">        according to the configuration of the Tracker.</span>
<span class="sd">        The currently alive and initialized tracked objects are returned</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        detections : Optional[List[Detection]], optional</span>
<span class="sd">            A list of [`Detection`][norfair.tracker.Detection] which represent the detections found in the current frame being processed.</span>

<span class="sd">            If no detections have been found in the current frame, or the user is purposely skipping frames to improve video processing time,</span>
<span class="sd">            this argument should be set to None or ignored, as the update function is needed to advance the state of the Kalman Filters inside the tracker.</span>
<span class="sd">        period : int, optional</span>
<span class="sd">            The user can chose not to run their detector on all frames, so as to process video faster.</span>
<span class="sd">            This parameter sets every how many frames the detector is getting ran,</span>
<span class="sd">            so that the tracker is aware of this situation and can handle it properly.</span>

<span class="sd">            This argument can be reset on each frame processed,</span>
<span class="sd">            which is useful if the user is dynamically changing how many frames the detector is skipping on a video when working in real-time.</span>
<span class="sd">        coord_transformations: Optional[CoordinatesTransformation]</span>
<span class="sd">            The coordinate transformation calculated by the [MotionEstimator][norfair.camera_motion.MotionEstimator].</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[TrackedObject]</span>
<span class="sd">            The list of active tracked objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">coord_transformations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">detections</span><span class="p">:</span>
                <span class="n">det</span><span class="o">.</span><span class="n">update_coordinate_transformation</span><span class="p">(</span><span class="n">coord_transformations</span><span class="p">)</span>

        <span class="c1"># Remove stale trackers and make candidate object real if the hit counter is positive</span>
        <span class="n">alive_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dead_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span> <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">hit_counter_is_positive</span>
            <span class="p">]</span>
            <span class="n">alive_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tracked_objects</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">reid_hit_counter_is_positive</span><span class="p">:</span>
                    <span class="n">tracked_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">hit_counter_is_positive</span><span class="p">:</span>
                        <span class="n">alive_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dead_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span> <span class="o">=</span> <span class="n">tracked_objects</span>

        <span class="c1"># Update tracker</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">tracker_step</span><span class="p">()</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">update_coordinate_transformation</span><span class="p">(</span><span class="n">coord_transformations</span><span class="p">)</span>

        <span class="c1"># Update initialized tracked objects with detections</span>
        <span class="p">(</span>
            <span class="n">unmatched_detections</span><span class="p">,</span>
            <span class="n">_</span><span class="p">,</span>
            <span class="n">unmatched_init_trackers</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_objects_in_place</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distance_function</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distance_threshold</span><span class="p">,</span>
            <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">alive_objects</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">o</span><span class="o">.</span><span class="n">is_initializing</span><span class="p">],</span>
            <span class="n">detections</span><span class="p">,</span>
            <span class="n">period</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Update not yet initialized tracked objects with yet unmatched detections</span>
        <span class="p">(</span>
            <span class="n">unmatched_detections</span><span class="p">,</span>
            <span class="n">matched_not_init_trackers</span><span class="p">,</span>
            <span class="n">_</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_objects_in_place</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distance_function</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">distance_threshold</span><span class="p">,</span>
            <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">alive_objects</span> <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">is_initializing</span><span class="p">],</span>
            <span class="n">unmatched_detections</span><span class="p">,</span>
            <span class="n">period</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reid_distance_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Match unmatched initialized tracked objects with not yet initialized tracked objects</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_objects_in_place</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reid_distance_function</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reid_distance_threshold</span><span class="p">,</span>
                <span class="n">unmatched_init_trackers</span> <span class="o">+</span> <span class="n">dead_objects</span><span class="p">,</span>
                <span class="n">matched_not_init_trackers</span><span class="p">,</span>
                <span class="n">period</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Create new tracked objects from remaining unmatched detections</span>
        <span class="k">for</span> <span class="n">detection</span> <span class="ow">in</span> <span class="n">unmatched_detections</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_obj_factory</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                    <span class="n">initial_detection</span><span class="o">=</span><span class="n">detection</span><span class="p">,</span>
                    <span class="n">hit_counter_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hit_counter_max</span><span class="p">,</span>
                    <span class="n">initialization_delay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initialization_delay</span><span class="p">,</span>
                    <span class="n">pointwise_hit_counter_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pointwise_hit_counter_max</span><span class="p">,</span>
                    <span class="n">detection_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">detection_threshold</span><span class="p">,</span>
                    <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
                    <span class="n">filter_factory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_factory</span><span class="p">,</span>
                    <span class="n">past_detections_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">past_detections_length</span><span class="p">,</span>
                    <span class="n">reid_hit_counter_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter_max</span><span class="p">,</span>
                    <span class="n">coord_transformations</span><span class="o">=</span><span class="n">coord_transformations</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_objects</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_object_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Number of active TrackedObjects&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_active_objects</span><span class="p">())</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">total_object_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Total number of TrackedObjects initialized in the by this Tracker&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj_factory</span><span class="o">.</span><span class="n">count</span>

    <span class="k">def</span> <span class="nf">get_active_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;TrackedObject&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the list of active objects</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        List[&quot;TrackedObject&quot;]</span>
<span class="sd">            The list of active objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">o</span>
            <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">o</span><span class="o">.</span><span class="n">is_initializing</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">hit_counter_is_positive</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_get_distances</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">distance_function</span><span class="p">,</span>
        <span class="n">distance_threshold</span><span class="p">,</span>
        <span class="n">objects</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="s2">&quot;TrackedObject&quot;</span><span class="p">],</span>
        <span class="n">candidates</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Detection&quot;</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;TrackedObject&quot;</span><span class="p">]]],</span>
    <span class="p">):</span>
        <span class="n">distance_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">objects</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">distance_matrix</span> <span class="o">*=</span> <span class="n">distance_threshold</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">candidates</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">o</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">objects</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">candidate</span><span class="o">.</span><span class="n">label</span> <span class="o">!=</span> <span class="n">obj</span><span class="o">.</span><span class="n">label</span><span class="p">:</span>
                    <span class="n">distance_matrix</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance_threshold</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">candidate</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">There are detections with and without label!&quot;</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="n">distance</span> <span class="o">=</span> <span class="n">distance_function</span><span class="p">(</span><span class="n">candidate</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>
                <span class="c1"># Cap detections and objects with no chance of getting matched so we</span>
                <span class="c1"># dont force the hungarian algorithm to minimize them and therefore</span>
                <span class="c1"># introduce the possibility of sub optimal results.</span>
                <span class="c1"># Note: This is probably not needed with the new distance minimizing algorithm</span>
                <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;</span> <span class="n">distance_threshold</span><span class="p">:</span>
                    <span class="n">distance_matrix</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance_threshold</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">distance_matrix</span><span class="p">[</span><span class="n">c</span><span class="p">,</span> <span class="n">o</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance</span>
        <span class="k">return</span> <span class="n">distance_matrix</span>

    <span class="k">def</span> <span class="nf">_update_objects_in_place</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">distance_function</span><span class="p">,</span>
        <span class="n">distance_threshold</span><span class="p">,</span>
        <span class="n">objects</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="s2">&quot;TrackedObject&quot;</span><span class="p">],</span>
        <span class="n">candidates</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Detection&quot;</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;TrackedObject&quot;</span><span class="p">]]],</span>
        <span class="n">period</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">candidates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">distance_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_distances</span><span class="p">(</span>
                <span class="n">distance_function</span><span class="p">,</span> <span class="n">distance_threshold</span><span class="p">,</span> <span class="n">objects</span><span class="p">,</span> <span class="n">candidates</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Received nan values from distance function, please check your distance function for errors!&quot;</span>
                <span class="p">)</span>
                <span class="n">exit</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Received inf values from distance function, please check your distance function for errors!&quot;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;If you want to explicitly ignore a certain detection - tracked object pair, just&quot;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;return distance_threshold + 1 from your distance function.&quot;</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">()</span>

            <span class="c1"># Used just for debugging distance function</span>
            <span class="k">if</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">minimum</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">distance_matrix</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)):</span>
                    <span class="n">objects</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">current_min_distance</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">minimum</span> <span class="k">if</span> <span class="n">minimum</span> <span class="o">&lt;</span> <span class="n">distance_threshold</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">)</span>

            <span class="n">matched_cand_indices</span><span class="p">,</span> <span class="n">matched_obj_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">match_dets_and_objs</span><span class="p">(</span>
                <span class="n">distance_matrix</span><span class="p">,</span> <span class="n">distance_threshold</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matched_cand_indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">unmatched_candidates</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">d</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">matched_cand_indices</span>
                <span class="p">]</span>
                <span class="n">unmatched_objects</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">d</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">objects</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">matched_obj_indices</span>
                <span class="p">]</span>
                <span class="n">matched_objects</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="c1"># Handle matched people/detections</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">match_cand_idx</span><span class="p">,</span> <span class="n">match_obj_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="n">matched_cand_indices</span><span class="p">,</span> <span class="n">matched_obj_indices</span>
                <span class="p">):</span>
                    <span class="n">match_distance</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="p">[</span><span class="n">match_cand_idx</span><span class="p">,</span> <span class="n">match_obj_idx</span><span class="p">]</span>
                    <span class="n">matched_candidate</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="n">match_cand_idx</span><span class="p">]</span>
                    <span class="n">matched_object</span> <span class="o">=</span> <span class="n">objects</span><span class="p">[</span><span class="n">match_obj_idx</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">match_distance</span> <span class="o">&lt;</span> <span class="n">distance_threshold</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matched_candidate</span><span class="p">,</span> <span class="n">Detection</span><span class="p">):</span>
                            <span class="n">matched_object</span><span class="o">.</span><span class="n">hit</span><span class="p">(</span><span class="n">matched_candidate</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">)</span>
                            <span class="n">matched_object</span><span class="o">.</span><span class="n">last_distance</span> <span class="o">=</span> <span class="n">match_distance</span>
                            <span class="n">matched_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">matched_object</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">matched_candidate</span><span class="p">,</span> <span class="n">TrackedObject</span><span class="p">):</span>
                            <span class="c1"># Merge new TrackedObject with the old one</span>
                            <span class="n">matched_object</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">matched_candidate</span><span class="p">)</span>
                            <span class="c1"># If we are matching TrackedObject instances we want to get rid of the</span>
                            <span class="c1"># already matched candidate to avoid matching it again in future frames</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">matched_candidate</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">unmatched_candidates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">matched_candidate</span><span class="p">)</span>
                        <span class="n">unmatched_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">matched_object</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unmatched_candidates</span><span class="p">,</span> <span class="n">matched_objects</span><span class="p">,</span> <span class="n">unmatched_objects</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">candidates</span><span class="p">,</span>
                    <span class="p">[],</span>
                    <span class="n">objects</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unmatched_candidates</span><span class="p">,</span> <span class="n">matched_objects</span><span class="p">,</span> <span class="n">unmatched_objects</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="n">objects</span>

        <span class="k">return</span> <span class="n">unmatched_candidates</span><span class="p">,</span> <span class="n">matched_objects</span><span class="p">,</span> <span class="n">unmatched_objects</span>

    <span class="k">def</span> <span class="nf">match_dets_and_objs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">distance_threshold</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Matches detections with tracked_objects from a distance matrix</span>

<span class="sd">        I used to match by minimizing the global distances, but found several</span>
<span class="sd">        cases in which this was not optimal. So now I just match by starting</span>
<span class="sd">        with the global minimum distance and matching the det-obj corresponding</span>
<span class="sd">        to that distance, then taking the second minimum, and so on until we</span>
<span class="sd">        reach the distance_threshold.</span>

<span class="sd">        This avoids the the algorithm getting cute with us and matching things</span>
<span class="sd">        that shouldn&#39;t be matching just for the sake of minimizing the global</span>
<span class="sd">        distance, which is what used to happen</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE: This implementation is terribly inefficient, but it doesn&#39;t</span>
        <span class="c1">#       seem to affect the fps at all.</span>
        <span class="n">distance_matrix</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">det_idxs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">obj_idxs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">current_min</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

            <span class="k">while</span> <span class="n">current_min</span> <span class="o">&lt;</span> <span class="n">distance_threshold</span><span class="p">:</span>
                <span class="n">flattened_arg_min</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
                <span class="n">det_idx</span> <span class="o">=</span> <span class="n">flattened_arg_min</span> <span class="o">//</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">obj_idx</span> <span class="o">=</span> <span class="n">flattened_arg_min</span> <span class="o">%</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">det_idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">det_idx</span><span class="p">)</span>
                <span class="n">obj_idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj_idx</span><span class="p">)</span>
                <span class="n">distance_matrix</span><span class="p">[</span><span class="n">det_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">distance_threshold</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">distance_matrix</span><span class="p">[:,</span> <span class="n">obj_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance_threshold</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">current_min</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">det_idxs</span><span class="p">,</span> <span class="n">obj_idxs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="norfair.tracker.Tracker.update">
<code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">detections</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">coord_transformations</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a class="headerlink" href="#norfair.tracker.Tracker.update" title="Permanent link">#</a></h3>


  <div class="doc doc-contents ">
  
      <p>Process detections found in each frame.</p>
<p>The detections can be matched to previous tracked objects or new ones will be created
according to the configuration of the Tracker.
The currently alive and initialized tracked objects are returned</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>detections</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="norfair.tracker.Detection" href="#norfair.tracker.Detection">Detection</a>]], optional</code>
          </td>
          <td><p>A list of <a class="autorefs autorefs-internal" href="#norfair.tracker.Detection"><code>Detection</code></a> which represent the detections found in the current frame being processed.</p>
<p>If no detections have been found in the current frame, or the user is purposely skipping frames to improve video processing time,
this argument should be set to None or ignored, as the update function is needed to advance the state of the Kalman Filters inside the tracker.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>period</code></td>
          <td>
                <code>int, optional</code>
          </td>
          <td><p>The user can chose not to run their detector on all frames, so as to process video faster.
This parameter sets every how many frames the detector is getting ran,
so that the tracker is aware of this situation and can handle it properly.</p>
<p>This argument can be reset on each frame processed,
which is useful if the user is dynamically changing how many frames the detector is skipping on a video when working in real-time.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>coord_transformations</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="norfair.camera_motion.CoordinatesTransformation" href="../camera_motion/#norfair.camera_motion.CoordinatesTransformation">CoordinatesTransformation</a>]</code>
          </td>
          <td><p>The coordinate transformation calculated by the <a class="autorefs autorefs-internal" href="../camera_motion/#norfair.camera_motion.MotionEstimator">MotionEstimator</a>.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="norfair.tracker.TrackedObject" href="#norfair.tracker.TrackedObject">TrackedObject</a>]</code>
          </td>
          <td><p>The list of active tracked objects.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>norfair/tracker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">detections</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="s2">&quot;Detection&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">period</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">coord_transformations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CoordinatesTransformation</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;TrackedObject&quot;</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Process detections found in each frame.</span>

<span class="sd">    The detections can be matched to previous tracked objects or new ones will be created</span>
<span class="sd">    according to the configuration of the Tracker.</span>
<span class="sd">    The currently alive and initialized tracked objects are returned</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    detections : Optional[List[Detection]], optional</span>
<span class="sd">        A list of [`Detection`][norfair.tracker.Detection] which represent the detections found in the current frame being processed.</span>

<span class="sd">        If no detections have been found in the current frame, or the user is purposely skipping frames to improve video processing time,</span>
<span class="sd">        this argument should be set to None or ignored, as the update function is needed to advance the state of the Kalman Filters inside the tracker.</span>
<span class="sd">    period : int, optional</span>
<span class="sd">        The user can chose not to run their detector on all frames, so as to process video faster.</span>
<span class="sd">        This parameter sets every how many frames the detector is getting ran,</span>
<span class="sd">        so that the tracker is aware of this situation and can handle it properly.</span>

<span class="sd">        This argument can be reset on each frame processed,</span>
<span class="sd">        which is useful if the user is dynamically changing how many frames the detector is skipping on a video when working in real-time.</span>
<span class="sd">    coord_transformations: Optional[CoordinatesTransformation]</span>
<span class="sd">        The coordinate transformation calculated by the [MotionEstimator][norfair.camera_motion.MotionEstimator].</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[TrackedObject]</span>
<span class="sd">        The list of active tracked objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">coord_transformations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">detections</span><span class="p">:</span>
            <span class="n">det</span><span class="o">.</span><span class="n">update_coordinate_transformation</span><span class="p">(</span><span class="n">coord_transformations</span><span class="p">)</span>

    <span class="c1"># Remove stale trackers and make candidate object real if the hit counter is positive</span>
    <span class="n">alive_objects</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dead_objects</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span> <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">hit_counter_is_positive</span>
        <span class="p">]</span>
        <span class="n">alive_objects</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tracked_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">reid_hit_counter_is_positive</span><span class="p">:</span>
                <span class="n">tracked_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">hit_counter_is_positive</span><span class="p">:</span>
                    <span class="n">alive_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dead_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">o</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span> <span class="o">=</span> <span class="n">tracked_objects</span>

    <span class="c1"># Update tracker</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="p">:</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">tracker_step</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">update_coordinate_transformation</span><span class="p">(</span><span class="n">coord_transformations</span><span class="p">)</span>

    <span class="c1"># Update initialized tracked objects with detections</span>
    <span class="p">(</span>
        <span class="n">unmatched_detections</span><span class="p">,</span>
        <span class="n">_</span><span class="p">,</span>
        <span class="n">unmatched_init_trackers</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_objects_in_place</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_function</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_threshold</span><span class="p">,</span>
        <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">alive_objects</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">o</span><span class="o">.</span><span class="n">is_initializing</span><span class="p">],</span>
        <span class="n">detections</span><span class="p">,</span>
        <span class="n">period</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Update not yet initialized tracked objects with yet unmatched detections</span>
    <span class="p">(</span>
        <span class="n">unmatched_detections</span><span class="p">,</span>
        <span class="n">matched_not_init_trackers</span><span class="p">,</span>
        <span class="n">_</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_objects_in_place</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_function</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_threshold</span><span class="p">,</span>
        <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">alive_objects</span> <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">is_initializing</span><span class="p">],</span>
        <span class="n">unmatched_detections</span><span class="p">,</span>
        <span class="n">period</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reid_distance_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Match unmatched initialized tracked objects with not yet initialized tracked objects</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_objects_in_place</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reid_distance_function</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reid_distance_threshold</span><span class="p">,</span>
            <span class="n">unmatched_init_trackers</span> <span class="o">+</span> <span class="n">dead_objects</span><span class="p">,</span>
            <span class="n">matched_not_init_trackers</span><span class="p">,</span>
            <span class="n">period</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Create new tracked objects from remaining unmatched detections</span>
    <span class="k">for</span> <span class="n">detection</span> <span class="ow">in</span> <span class="n">unmatched_detections</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_obj_factory</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">initial_detection</span><span class="o">=</span><span class="n">detection</span><span class="p">,</span>
                <span class="n">hit_counter_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hit_counter_max</span><span class="p">,</span>
                <span class="n">initialization_delay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initialization_delay</span><span class="p">,</span>
                <span class="n">pointwise_hit_counter_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pointwise_hit_counter_max</span><span class="p">,</span>
                <span class="n">detection_threshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">detection_threshold</span><span class="p">,</span>
                <span class="n">period</span><span class="o">=</span><span class="n">period</span><span class="p">,</span>
                <span class="n">filter_factory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filter_factory</span><span class="p">,</span>
                <span class="n">past_detections_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">past_detections_length</span><span class="p">,</span>
                <span class="n">reid_hit_counter_max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter_max</span><span class="p">,</span>
                <span class="n">coord_transformations</span><span class="o">=</span><span class="n">coord_transformations</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_active_objects</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="norfair.tracker.Tracker.current_object_count">
<code class="highlight language-python"><span class="n">current_object_count</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a class="headerlink" href="#norfair.tracker.Tracker.current_object_count" title="Permanent link">#</a></h3>


  <div class="doc doc-contents ">
  
      <p>Number of active TrackedObjects</p>

      <details class="quote">
        <summary>Source code in <code>norfair/tracker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">current_object_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Number of active TrackedObjects&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_active_objects</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="norfair.tracker.Tracker.total_object_count">
<code class="highlight language-python"><span class="n">total_object_count</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a class="headerlink" href="#norfair.tracker.Tracker.total_object_count" title="Permanent link">#</a></h3>


  <div class="doc doc-contents ">
  
      <p>Total number of TrackedObjects initialized in the by this Tracker</p>

      <details class="quote">
        <summary>Source code in <code>norfair/tracker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@property</span>
<span class="k">def</span> <span class="nf">total_object_count</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Total number of TrackedObjects initialized in the by this Tracker&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj_factory</span><span class="o">.</span><span class="n">count</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="norfair.tracker.Tracker.get_active_objects">
<code class="highlight language-python"><span class="n">get_active_objects</span><span class="p">()</span></code>

<a class="headerlink" href="#norfair.tracker.Tracker.get_active_objects" title="Permanent link">#</a></h3>


  <div class="doc doc-contents ">
  
      <p>Get the list of active objects</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="norfair.tracker.TrackedObject" href="#norfair.tracker.TrackedObject">TrackedObject</a>]</code>
          </td>
          <td><p>The list of active objects</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>norfair/tracker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_active_objects</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;TrackedObject&quot;</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Get the list of active objects</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    List[&quot;TrackedObject&quot;]</span>
<span class="sd">        The list of active objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="n">o</span>
        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracked_objects</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">o</span><span class="o">.</span><span class="n">is_initializing</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">hit_counter_is_positive</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="norfair.tracker.Tracker.match_dets_and_objs">
<code class="highlight language-python"><span class="n">match_dets_and_objs</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">,</span> <span class="n">distance_threshold</span><span class="p">)</span></code>

<a class="headerlink" href="#norfair.tracker.Tracker.match_dets_and_objs" title="Permanent link">#</a></h3>


  <div class="doc doc-contents ">
  
      <p>Matches detections with tracked_objects from a distance matrix</p>
<p>I used to match by minimizing the global distances, but found several
cases in which this was not optimal. So now I just match by starting
with the global minimum distance and matching the det-obj corresponding
to that distance, then taking the second minimum, and so on until we
reach the distance_threshold.</p>
<p>This avoids the the algorithm getting cute with us and matching things
that shouldn't be matching just for the sake of minimizing the global
distance, which is what used to happen</p>

      <details class="quote">
        <summary>Source code in <code>norfair/tracker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">match_dets_and_objs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">distance_threshold</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Matches detections with tracked_objects from a distance matrix</span>

<span class="sd">    I used to match by minimizing the global distances, but found several</span>
<span class="sd">    cases in which this was not optimal. So now I just match by starting</span>
<span class="sd">    with the global minimum distance and matching the det-obj corresponding</span>
<span class="sd">    to that distance, then taking the second minimum, and so on until we</span>
<span class="sd">    reach the distance_threshold.</span>

<span class="sd">    This avoids the the algorithm getting cute with us and matching things</span>
<span class="sd">    that shouldn&#39;t be matching just for the sake of minimizing the global</span>
<span class="sd">    distance, which is what used to happen</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># NOTE: This implementation is terribly inefficient, but it doesn&#39;t</span>
    <span class="c1">#       seem to affect the fps at all.</span>
    <span class="n">distance_matrix</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">det_idxs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">obj_idxs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_min</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="k">while</span> <span class="n">current_min</span> <span class="o">&lt;</span> <span class="n">distance_threshold</span><span class="p">:</span>
            <span class="n">flattened_arg_min</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
            <span class="n">det_idx</span> <span class="o">=</span> <span class="n">flattened_arg_min</span> <span class="o">//</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">obj_idx</span> <span class="o">=</span> <span class="n">flattened_arg_min</span> <span class="o">%</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">det_idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">det_idx</span><span class="p">)</span>
            <span class="n">obj_idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj_idx</span><span class="p">)</span>
            <span class="n">distance_matrix</span><span class="p">[</span><span class="n">det_idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">distance_threshold</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">distance_matrix</span><span class="p">[:,</span> <span class="n">obj_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">distance_threshold</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">current_min</span> <span class="o">=</span> <span class="n">distance_matrix</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">det_idxs</span><span class="p">,</span> <span class="n">obj_idxs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[],</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="norfair.tracker.TrackedObject">
        <code>TrackedObject</code>


<a class="headerlink" href="#norfair.tracker.TrackedObject" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">

  
      <p>The objects returned by the tracker's <code>update</code> function on each iteration.</p>
<p>They represent the objects currently being tracked by the tracker.</p>
<p>Users should not instantiate TrackedObjects manually;
the Tracker will be in charge of creating them.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>estimate</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Where the tracker predicts the point will be in the current frame based on past detections.
A numpy array with the same shape as the detections being fed to the tracker that produced it.</p></td>
        </tr>
        <tr>
          <td><code>id</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[int]</code>
          </td>
          <td><p>The unique identifier assigned to this object by the tracker. Set to <code>None</code> if the object is initializing.</p></td>
        </tr>
        <tr>
          <td><code>global_id</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[int]</code>
          </td>
          <td><p>The globally unique identifier assigned to this object. Set to <code>None</code> if the object is initializing</p></td>
        </tr>
        <tr>
          <td><code>last_detection</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="norfair.tracker.Detection" href="#norfair.tracker.Detection">Detection</a></code>
          </td>
          <td><p>The last detection that matched with this tracked object.
Useful if you are storing embeddings in your detections and want to do metric learning, or for debugging.</p></td>
        </tr>
        <tr>
          <td><code>last_distance</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[float]</code>
          </td>
          <td><p>The distance the tracker had with the last object it matched with.</p></td>
        </tr>
        <tr>
          <td><code>age</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>The age of this object measured in number of frames.</p></td>
        </tr>
        <tr>
          <td><code>live_points</code></td>
          <td>
          </td>
          <td><p>A boolean mask with shape <code>(n_points,)</code>. Points marked as <code>True</code> have recently been matched with detections.
Points marked as <code>False</code> haven't and are to be considered stale, and should be ignored.</p>
<p>Functions like <a class="autorefs autorefs-internal" href="../drawing/#norfair.drawing.draw_tracked_objects"><code>draw_tracked_objects</code></a> use this property to determine which points not to draw.</p></td>
        </tr>
        <tr>
          <td><code>initializing_id</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>On top of <code>id</code>, objects also have an <code>initializing_id</code> which is the id they are given internally by the <code>Tracker</code>;
this id is used solely for debugging.</p>
<p>Each new object created by the <code>Tracker</code> starts as an uninitialized <code>TrackedObject</code>,
which needs to reach a certain match rate to be converted into a full blown <code>TrackedObject</code>.
<code>initializing_id</code> is the id temporarily assigned to <code>TrackedObject</code> while they are getting initialized.</p></td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>norfair/tracker.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TrackedObject</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The objects returned by the tracker&#39;s `update` function on each iteration.</span>

<span class="sd">    They represent the objects currently being tracked by the tracker.</span>

<span class="sd">    Users should not instantiate TrackedObjects manually;</span>
<span class="sd">    the Tracker will be in charge of creating them.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    estimate : np.ndarray</span>
<span class="sd">        Where the tracker predicts the point will be in the current frame based on past detections.</span>
<span class="sd">        A numpy array with the same shape as the detections being fed to the tracker that produced it.</span>
<span class="sd">    id : Optional[int]</span>
<span class="sd">        The unique identifier assigned to this object by the tracker. Set to `None` if the object is initializing.</span>
<span class="sd">    global_id : Optional[int]</span>
<span class="sd">        The globally unique identifier assigned to this object. Set to `None` if the object is initializing</span>
<span class="sd">    last_detection : Detection</span>
<span class="sd">        The last detection that matched with this tracked object.</span>
<span class="sd">        Useful if you are storing embeddings in your detections and want to do metric learning, or for debugging.</span>
<span class="sd">    last_distance : Optional[float]</span>
<span class="sd">        The distance the tracker had with the last object it matched with.</span>
<span class="sd">    age : int</span>
<span class="sd">        The age of this object measured in number of frames.</span>
<span class="sd">    live_points :</span>
<span class="sd">        A boolean mask with shape `(n_points,)`. Points marked as `True` have recently been matched with detections.</span>
<span class="sd">        Points marked as `False` haven&#39;t and are to be considered stale, and should be ignored.</span>

<span class="sd">        Functions like [`draw_tracked_objects`][norfair.drawing.draw_tracked_objects] use this property to determine which points not to draw.</span>
<span class="sd">    initializing_id : int</span>
<span class="sd">        On top of `id`, objects also have an `initializing_id` which is the id they are given internally by the `Tracker`;</span>
<span class="sd">        this id is used solely for debugging.</span>

<span class="sd">        Each new object created by the `Tracker` starts as an uninitialized `TrackedObject`,</span>
<span class="sd">        which needs to reach a certain match rate to be converted into a full blown `TrackedObject`.</span>
<span class="sd">        `initializing_id` is the id temporarily assigned to `TrackedObject` while they are getting initialized.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">obj_factory</span><span class="p">:</span> <span class="n">_TrackedObjectFactory</span><span class="p">,</span>
        <span class="n">initial_detection</span><span class="p">:</span> <span class="s2">&quot;Detection&quot;</span><span class="p">,</span>
        <span class="n">hit_counter_max</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">initialization_delay</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">pointwise_hit_counter_max</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">detection_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">period</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">filter_factory</span><span class="p">:</span> <span class="s2">&quot;FilterFactory&quot;</span><span class="p">,</span>
        <span class="n">past_detections_length</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">reid_hit_counter_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">coord_transformations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CoordinatesTransformation</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">initial_detection</span><span class="p">,</span> <span class="n">Detection</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[red]ERROR[/red]: The detection list fed into `tracker.update()` should be composed of </span><span class="si">{</span><span class="n">Detection</span><span class="si">}</span><span class="s2"> objects not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">initial_detection</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">exit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_obj_factory</span> <span class="o">=</span> <span class="n">obj_factory</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_points</span> <span class="o">=</span> <span class="n">initial_detection</span><span class="o">.</span><span class="n">absolute_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span> <span class="o">=</span> <span class="n">initial_detection</span><span class="o">.</span><span class="n">absolute_points</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter_max</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">hit_counter_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pointwise_hit_counter_max</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pointwise_hit_counter_max</span><span class="p">,</span> <span class="n">period</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialization_delay</span> <span class="o">=</span> <span class="n">initialization_delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detection_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">detection_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_period</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter_max</span> <span class="o">=</span> <span class="n">reid_hit_counter_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_distance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_min_distance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_detection</span><span class="p">:</span> <span class="s2">&quot;Detection&quot;</span> <span class="o">=</span> <span class="n">initial_detection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_initializing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialization_delay</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initializing_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj_factory</span><span class="o">.</span><span class="n">get_initializing_id</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initializing</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_acquire_ids</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">initial_detection</span><span class="o">.</span><span class="n">scores</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detected_at_least_once_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detected_at_least_once_points</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">initial_detection</span><span class="o">.</span><span class="n">scores</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">detection_threshold</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected_at_least_once_points</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="nb">int</span>
        <span class="p">)</span>
        <span class="n">initial_detection</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">past_detections_length</span> <span class="o">=</span> <span class="n">past_detections_length</span>
        <span class="k">if</span> <span class="n">past_detections_length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">past_detections</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="s2">&quot;Detection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_detection</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">past_detections</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="s2">&quot;Detection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Create Kalman Filter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">filter_factory</span><span class="o">.</span><span class="n">create_filter</span><span class="p">(</span><span class="n">initial_detection</span><span class="o">.</span><span class="n">absolute_points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dim_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_points</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">initial_detection</span><span class="o">.</span><span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abs_to_rel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">coord_transformations</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_coordinate_transformation</span><span class="p">(</span><span class="n">coord_transformations</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">tracker_step</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter_max</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># Advances the tracker&#39;s state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">hit_counter_is_positive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">reid_hit_counter_is_positive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter</span> <span class="o">&gt;=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_z</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_points</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_to_rel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_to_rel</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">positions</span>

    <span class="k">def</span> <span class="nf">get_estimate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">absolute</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_z</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_to_rel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">absolute</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">positions</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;You must provide &#39;coord_transformations&#39; to the tracker to get absolute coordinates&quot;</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">absolute</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">positions</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">abs_to_rel</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">live_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">hit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detection</span><span class="p">:</span> <span class="s2">&quot;Detection&quot;</span><span class="p">,</span> <span class="n">period</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Update tracked object with a new detection</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        detection : Detection</span>
<span class="sd">            the new detection matched to this tracked object</span>
<span class="sd">        period : int, optional</span>
<span class="sd">            frames corresponding to the period of time since last update.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conditionally_add_to_past_detections</span><span class="p">(</span><span class="n">detection</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_detection</span> <span class="o">=</span> <span class="n">detection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">period</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter_max</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initializing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialization_delay</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_initializing</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_acquire_ids</span><span class="p">()</span>

        <span class="c1"># We use a kalman filter in which we consider each coordinate on each point as a sensor.</span>
        <span class="c1"># This is a hacky way to update only certain sensors (only x, y coordinates for</span>
        <span class="c1"># points which were detected).</span>
        <span class="c1"># TODO: Use keypoint confidence information to change R on each sensor instead?</span>
        <span class="k">if</span> <span class="n">detection</span><span class="o">.</span><span class="n">scores</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">detection</span><span class="o">.</span><span class="n">scores</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="n">points_over_threshold_mask</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">scores</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">detection_threshold</span>
            <span class="n">matched_sensors_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">m</span><span class="p">,)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_points</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">points_over_threshold_mask</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
            <span class="n">H_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">matched_sensors_mask</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                <span class="nb">float</span>
            <span class="p">)</span>  <span class="c1"># We measure x, y positions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span><span class="p">[</span><span class="n">points_over_threshold_mask</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">period</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">points_over_threshold_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span><span class="p">)</span>
            <span class="n">H_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_points</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_points</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointwise_hit_counter_max</span>
        <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointwise_hit_counter_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">H_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">H_pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># But we don&#39;t directly measure velocity</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">H_pos</span><span class="p">,</span> <span class="n">H_vel</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">detection</span><span class="o">.</span><span class="n">absolute_points</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">H</span>
        <span class="p">)</span>

        <span class="n">detected_at_least_once_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">m</span><span class="p">,)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_points</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected_at_least_once_points</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">now_detected_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
            <span class="p">(</span><span class="n">points_over_threshold_mask</span><span class="p">,)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_points</span>
        <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">first_detection_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
            <span class="n">now_detected_mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">detected_at_least_once_mask</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">x</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_z</span><span class="p">][</span><span class="n">first_detection_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
            <span class="n">detection</span><span class="o">.</span><span class="n">absolute_points</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="mi">0</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">first_detection_mask</span><span class="p">]</span>

        <span class="c1"># Force points being detected for the first time to have velocity = 0</span>
        <span class="c1"># This is needed because some detectors (like OpenPose) set points with</span>
        <span class="c1"># low confidence to coordinates (0, 0). And when they then get their first</span>
        <span class="c1"># real detection this creates a huge velocity vector in our KalmanFilter</span>
        <span class="c1"># and causes the tracker to start with wildly inaccurate estimations which</span>
        <span class="c1"># eventually coverge to the real detections.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_z</span> <span class="p">:][</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">detected_at_least_once_mask</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detected_at_least_once_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detected_at_least_once_points</span><span class="p">,</span> <span class="n">points_over_threshold_mask</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">placeholder_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1mObject_</span><span class="si">{}</span><span class="se">\033</span><span class="s2">[0m(age: </span><span class="si">{}</span><span class="s2">, hit_counter: </span><span class="si">{}</span><span class="s2">, last_distance: </span><span class="si">{}</span><span class="s2">, init_id: </span><span class="si">{}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">placeholder_text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1mObject_</span><span class="si">{}</span><span class="se">\033</span><span class="s2">[0m(age: </span><span class="si">{}</span><span class="s2">, hit_counter: </span><span class="si">{}</span><span class="s2">, last_distance: </span><span class="si">{:.2f}</span><span class="s2">, init_id: </span><span class="si">{}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="n">placeholder_text</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_distance</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initializing_id</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_conditionally_add_to_past_detections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detection</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds detections into (and pops detections away) from `past_detections`</span>

<span class="sd">        It does so by keeping a fixed amount of past detections saved into each</span>
<span class="sd">        TrackedObject, while maintaining them distributed uniformly through the object&#39;s</span>
<span class="sd">        lifetime.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">past_detections_length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">past_detections</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">past_detections_length</span><span class="p">:</span>
            <span class="n">detection</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">past_detections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detection</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">past_detections</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">age</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">past_detections_length</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">past_detections</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">detection</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">past_detections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">detection</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tracked_object</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Merge with a not yet initialized TrackedObject instance&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_period</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span> <span class="o">=</span> <span class="n">tracked_object</span><span class="o">.</span><span class="n">point_hit_counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_distance</span> <span class="o">=</span> <span class="n">tracked_object</span><span class="o">.</span><span class="n">last_distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_min_distance</span> <span class="o">=</span> <span class="n">tracked_object</span><span class="o">.</span><span class="n">current_min_distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_detection</span> <span class="o">=</span> <span class="n">tracked_object</span><span class="o">.</span><span class="n">last_detection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detected_at_least_once_points</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">tracked_object</span><span class="o">.</span><span class="n">detected_at_least_once_points</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">tracked_object</span><span class="o">.</span><span class="n">filter</span>

        <span class="k">for</span> <span class="n">past_detection</span> <span class="ow">in</span> <span class="n">tracked_object</span><span class="o">.</span><span class="n">past_detections</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_conditionally_add_to_past_detections</span><span class="p">(</span><span class="n">past_detection</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_coordinate_transformation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">coordinate_transformation</span><span class="p">:</span> <span class="n">CoordinatesTransformation</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">coordinate_transformation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abs_to_rel</span> <span class="o">=</span> <span class="n">coordinate_transformation</span><span class="o">.</span><span class="n">abs_to_rel</span>

    <span class="k">def</span> <span class="nf">_acquire_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_obj_factory</span><span class="o">.</span><span class="n">get_ids</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="norfair.tracker.TrackedObject.hit">
<code class="highlight language-python"><span class="n">hit</span><span class="p">(</span><span class="n">detection</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a class="headerlink" href="#norfair.tracker.TrackedObject.hit" title="Permanent link">#</a></h3>


  <div class="doc doc-contents ">
  
      <p>Update tracked object with a new detection</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>detection</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="norfair.tracker.Detection" href="#norfair.tracker.Detection">Detection</a></code>
          </td>
          <td><p>the new detection matched to this tracked object</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>period</code></td>
          <td>
                <code>int, optional</code>
          </td>
          <td><p>frames corresponding to the period of time since last update.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>norfair/tracker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">hit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detection</span><span class="p">:</span> <span class="s2">&quot;Detection&quot;</span><span class="p">,</span> <span class="n">period</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Update tracked object with a new detection</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    detection : Detection</span>
<span class="sd">        the new detection matched to this tracked object</span>
<span class="sd">    period : int, optional</span>
<span class="sd">        frames corresponding to the period of time since last update.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_conditionally_add_to_past_detections</span><span class="p">(</span><span class="n">detection</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">last_detection</span> <span class="o">=</span> <span class="n">detection</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">period</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter_max</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initializing</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">initialization_delay</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_initializing</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_acquire_ids</span><span class="p">()</span>

    <span class="c1"># We use a kalman filter in which we consider each coordinate on each point as a sensor.</span>
    <span class="c1"># This is a hacky way to update only certain sensors (only x, y coordinates for</span>
    <span class="c1"># points which were detected).</span>
    <span class="c1"># TODO: Use keypoint confidence information to change R on each sensor instead?</span>
    <span class="k">if</span> <span class="n">detection</span><span class="o">.</span><span class="n">scores</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">detection</span><span class="o">.</span><span class="n">scores</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="n">points_over_threshold_mask</span> <span class="o">=</span> <span class="n">detection</span><span class="o">.</span><span class="n">scores</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">detection_threshold</span>
        <span class="n">matched_sensors_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[(</span><span class="n">m</span><span class="p">,)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_points</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">points_over_threshold_mask</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">H_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">matched_sensors_mask</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="nb">float</span>
        <span class="p">)</span>  <span class="c1"># We measure x, y positions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span><span class="p">[</span><span class="n">points_over_threshold_mask</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">period</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">points_over_threshold_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_points</span><span class="p">)</span>
        <span class="n">H_pos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_points</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">period</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span><span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointwise_hit_counter_max</span>
    <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pointwise_hit_counter_max</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">H_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">H_pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># But we don&#39;t directly measure velocity</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">H_pos</span><span class="p">,</span> <span class="n">H_vel</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">detection</span><span class="o">.</span><span class="n">absolute_points</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">H</span>
    <span class="p">)</span>

    <span class="n">detected_at_least_once_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[(</span><span class="n">m</span><span class="p">,)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_points</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">detected_at_least_once_points</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">now_detected_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
        <span class="p">(</span><span class="n">points_over_threshold_mask</span><span class="p">,)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_points</span>
    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">first_detection_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span>
        <span class="n">now_detected_mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">detected_at_least_once_mask</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">x</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dim_z</span><span class="p">][</span><span class="n">first_detection_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span>
        <span class="n">detection</span><span class="o">.</span><span class="n">absolute_points</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="mi">0</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">first_detection_mask</span><span class="p">]</span>

    <span class="c1"># Force points being detected for the first time to have velocity = 0</span>
    <span class="c1"># This is needed because some detectors (like OpenPose) set points with</span>
    <span class="c1"># low confidence to coordinates (0, 0). And when they then get their first</span>
    <span class="c1"># real detection this creates a huge velocity vector in our KalmanFilter</span>
    <span class="c1"># and causes the tracker to start with wildly inaccurate estimations which</span>
    <span class="c1"># eventually coverge to the real detections.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filter</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dim_z</span> <span class="p">:][</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">detected_at_least_once_mask</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">detected_at_least_once_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detected_at_least_once_points</span><span class="p">,</span> <span class="n">points_over_threshold_mask</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="norfair.tracker.TrackedObject.merge">
<code class="highlight language-python"><span class="n">merge</span><span class="p">(</span><span class="n">tracked_object</span><span class="p">)</span></code>

<a class="headerlink" href="#norfair.tracker.TrackedObject.merge" title="Permanent link">#</a></h3>


  <div class="doc doc-contents ">
  
      <p>Merge with a not yet initialized TrackedObject instance</p>

      <details class="quote">
        <summary>Source code in <code>norfair/tracker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tracked_object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Merge with a not yet initialized TrackedObject instance&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reid_hit_counter</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">hit_counter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_period</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">point_hit_counter</span> <span class="o">=</span> <span class="n">tracked_object</span><span class="o">.</span><span class="n">point_hit_counter</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_distance</span> <span class="o">=</span> <span class="n">tracked_object</span><span class="o">.</span><span class="n">last_distance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_min_distance</span> <span class="o">=</span> <span class="n">tracked_object</span><span class="o">.</span><span class="n">current_min_distance</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">last_detection</span> <span class="o">=</span> <span class="n">tracked_object</span><span class="o">.</span><span class="n">last_detection</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">detected_at_least_once_points</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">tracked_object</span><span class="o">.</span><span class="n">detected_at_least_once_points</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="n">tracked_object</span><span class="o">.</span><span class="n">filter</span>

    <span class="k">for</span> <span class="n">past_detection</span> <span class="ow">in</span> <span class="n">tracked_object</span><span class="o">.</span><span class="n">past_detections</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_conditionally_add_to_past_detections</span><span class="p">(</span><span class="n">past_detection</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="norfair.tracker.Detection">
        <code>Detection</code>


<a class="headerlink" href="#norfair.tracker.Detection" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">

  
      <p>Detections returned by the detector must be converted to a <code>Detection</code> object before being used by Norfair.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>points</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>Points detected. Must be a rank 2 array with shape <code>(n_points, n_dimensions)</code> where n_dimensions is 2 or 3.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>scores</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, optional</code>
          </td>
          <td><p>An array of length <code>n_points</code> which assigns a score to each of the points defined in <code>points</code>.</p>
<p>This is used to inform the tracker of which points to ignore;
any point with a score below <code>detection_threshold</code> will be ignored.</p>
<p>This useful for cases in which detections don't always have every point present, as is often the case in pose estimators.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>data</code></td>
          <td>
                <code><span title="typing.Any">Any</span>, optional</code>
          </td>
          <td><p>The place to store any extra data which may be useful when calculating the distance function.
Anything stored here will be available to use inside the distance function.</p>
<p>This enables the development of more interesting trackers which can do things like assign an appearance embedding to each
detection to aid in its tracking.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>label</code></td>
          <td>
                <code><span title="typing.Hashable">Hashable</span>, optional</code>
          </td>
          <td><p>When working with multiple classes the detection's label can be stored to be used as a matching condition when associating
tracked objects with new detections. Label's type must be hashable for drawing purposes.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>embedding</code></td>
          <td>
                <code><span title="typing.Any">Any</span>, optional</code>
          </td>
          <td><p>The embedding for the reid_distance.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>norfair/tracker.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Detection</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Detections returned by the detector must be converted to a `Detection` object before being used by Norfair.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    points : np.ndarray</span>
<span class="sd">        Points detected. Must be a rank 2 array with shape `(n_points, n_dimensions)` where n_dimensions is 2 or 3.</span>
<span class="sd">    scores : np.ndarray, optional</span>
<span class="sd">        An array of length `n_points` which assigns a score to each of the points defined in `points`.</span>

<span class="sd">        This is used to inform the tracker of which points to ignore;</span>
<span class="sd">        any point with a score below `detection_threshold` will be ignored.</span>

<span class="sd">        This useful for cases in which detections don&#39;t always have every point present, as is often the case in pose estimators.</span>
<span class="sd">    data : Any, optional</span>
<span class="sd">        The place to store any extra data which may be useful when calculating the distance function.</span>
<span class="sd">        Anything stored here will be available to use inside the distance function.</span>

<span class="sd">        This enables the development of more interesting trackers which can do things like assign an appearance embedding to each</span>
<span class="sd">        detection to aid in its tracking.</span>
<span class="sd">    label : Hashable, optional</span>
<span class="sd">        When working with multiple classes the detection&#39;s label can be stored to be used as a matching condition when associating</span>
<span class="sd">        tracked objects with new detections. Label&#39;s type must be hashable for drawing purposes.</span>
<span class="sd">    embedding : Any, optional</span>
<span class="sd">        The embedding for the reid_distance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
        <span class="n">scores</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">label</span><span class="p">:</span> <span class="n">Hashable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">embedding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">validate_points</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scores</span> <span class="o">=</span> <span class="n">scores</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">absolute_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="n">embedding</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">update_coordinate_transformation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">coordinate_transformation</span><span class="p">:</span> <span class="n">CoordinatesTransformation</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">coordinate_transformation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">absolute_points</span> <span class="o">=</span> <span class="n">coordinate_transformation</span><span class="o">.</span><span class="n">rel_to_abs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">absolute_points</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>




  </div>

  </div>

</div>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
      
        
        <a href="../drawing/" class="md-footer__link md-footer__link--next" aria-label="Next: Drawing" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Drawing
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.sections"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
        <script src="../../js/math.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>