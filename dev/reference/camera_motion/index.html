
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../img/icon.svg">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.4.1">
    
    
      
        <title>Camera Motion - Norfair</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/custom.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#camera-motion" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Norfair" class="md-header__button md-logo" aria-label="Norfair" data-md-component="logo">
      
  <img src="../../img/logo-dark.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Norfair
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Camera Motion
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/tryolabs/norfair" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tryolabs/norfair
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Norfair" class="md-nav__button md-logo" aria-label="Norfair" data-md-component="logo">
      
  <img src="../../img/logo-dark.svg" alt="logo">

    </a>
    Norfair
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/tryolabs/norfair" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    tryolabs/norfair
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../tracker/" class="md-nav__link">
        Tracker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../drawing/" class="md-nav__link">
        Drawing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../video/" class="md-nav__link">
        Video
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../distances/" class="md-nav__link">
        Distances
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Camera Motion
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Camera Motion
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion" class="md-nav__link">
    camera_motion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.CoordinatesTransformation" class="md-nav__link">
    CoordinatesTransformation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.TransformationGetter" class="md-nav__link">
    TransformationGetter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.TranslationTransformation" class="md-nav__link">
    TranslationTransformation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.TranslationTransformationGetter" class="md-nav__link">
    TranslationTransformationGetter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.HomographyTransformation" class="md-nav__link">
    HomographyTransformation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.HomographyTransformationGetter" class="md-nav__link">
    HomographyTransformationGetter
  </a>
  
    <nav class="md-nav" aria-label="HomographyTransformationGetter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#norfair.camera_motion.HomographyTransformationGetter--see-also" class="md-nav__link">
    See Also
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.MotionEstimator" class="md-nav__link">
    MotionEstimator
  </a>
  
    <nav class="md-nav" aria-label="MotionEstimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#norfair.camera_motion.MotionEstimator--see-also" class="md-nav__link">
    See Also
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#norfair.camera_motion.MotionEstimator.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../filter/" class="md-nav__link">
        Filter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion" class="md-nav__link">
    camera_motion
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.CoordinatesTransformation" class="md-nav__link">
    CoordinatesTransformation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.TransformationGetter" class="md-nav__link">
    TransformationGetter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.TranslationTransformation" class="md-nav__link">
    TranslationTransformation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.TranslationTransformationGetter" class="md-nav__link">
    TranslationTransformationGetter
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.HomographyTransformation" class="md-nav__link">
    HomographyTransformation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.HomographyTransformationGetter" class="md-nav__link">
    HomographyTransformationGetter
  </a>
  
    <nav class="md-nav" aria-label="HomographyTransformationGetter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#norfair.camera_motion.HomographyTransformationGetter--see-also" class="md-nav__link">
    See Also
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#norfair.camera_motion.MotionEstimator" class="md-nav__link">
    MotionEstimator
  </a>
  
    <nav class="md-nav" aria-label="MotionEstimator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#norfair.camera_motion.MotionEstimator--see-also" class="md-nav__link">
    See Also
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#norfair.camera_motion.MotionEstimator.update" class="md-nav__link">
    update()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="camera-motion">Camera Motion<a class="headerlink" href="#camera-motion" title="Permanent link">#</a></h1>


<div class="doc doc-object doc-module">


<a id="norfair.camera_motion"></a>
  <div class="doc doc-contents first">
  
      <p>Camera motion stimation module.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="norfair.camera_motion.CoordinatesTransformation">
        <code>CoordinatesTransformation</code>


<a class="headerlink" href="#norfair.camera_motion.CoordinatesTransformation" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Abstract class representing a coordinate transformation.</p>
<p>Detections' and tracked objects' coordinates can be interpreted in 2 reference:</p>
<ul>
<li><em>Relative</em>: their position on the current frame, (0, 0) is top left</li>
<li><em>Absolute</em>: their position on an fixed space, (0, 0)
    is the top left of the first frame of the video.</li>
</ul>
<p>Therefore, coordinate transformation in this context is a class that can transform
coordinates in one reference to another.</p>


        <details class="quote">
          <summary>Source code in <code>norfair/camera_motion.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">CoordinatesTransformation</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class representing a coordinate transformation.</span>

<span class="sd">    Detections&#39; and tracked objects&#39; coordinates can be interpreted in 2 reference:</span>

<span class="sd">    - _Relative_: their position on the current frame, (0, 0) is top left</span>
<span class="sd">    - _Absolute_: their position on an fixed space, (0, 0)</span>
<span class="sd">        is the top left of the first frame of the video.</span>

<span class="sd">    Therefore, coordinate transformation in this context is a class that can transform</span>
<span class="sd">    coordinates in one reference to another.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">abs_to_rel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">rel_to_abs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="norfair.camera_motion.TransformationGetter">
        <code>TransformationGetter</code>


<a class="headerlink" href="#norfair.camera_motion.TransformationGetter" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="abc.ABC">ABC</span></code></p>

  
      <p>Abstract class representing a method for finding CoordinatesTransformation between 2 sets of points</p>


        <details class="quote">
          <summary>Source code in <code>norfair/camera_motion.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TransformationGetter</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract class representing a method for finding CoordinatesTransformation between 2 sets of points</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">curr_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">prev_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">CoordinatesTransformation</span><span class="p">]:</span>
        <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="norfair.camera_motion.TranslationTransformation">
        <code>TranslationTransformation</code>


<a class="headerlink" href="#norfair.camera_motion.TranslationTransformation" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="norfair.camera_motion.CoordinatesTransformation" href="#norfair.camera_motion.CoordinatesTransformation">CoordinatesTransformation</a></code></p>

  
      <p>Coordinate transformation between points using a simple translation</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>movement_vector</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>The vector representing the translation.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>norfair/camera_motion.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TranslationTransformation</span><span class="p">(</span><span class="n">CoordinatesTransformation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coordinate transformation between points using a simple translation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    movement_vector : np.ndarray</span>
<span class="sd">        The vector representing the translation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">movement_vector</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">movement_vector</span> <span class="o">=</span> <span class="n">movement_vector</span>

    <span class="k">def</span> <span class="nf">abs_to_rel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">points</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">movement_vector</span>

    <span class="k">def</span> <span class="nf">rel_to_abs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">points</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">movement_vector</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="norfair.camera_motion.TranslationTransformationGetter">
        <code>TranslationTransformationGetter</code>


<a class="headerlink" href="#norfair.camera_motion.TranslationTransformationGetter" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="norfair.camera_motion.TransformationGetter" href="#norfair.camera_motion.TransformationGetter">TransformationGetter</a></code></p>

  
      <p>Calculates TranslationTransformation between points.</p>
<p>The camera movement is calculated as the mode of optical flow between the previous reference frame
and the current.</p>
<p>Comparing consecutive frames can make differences too small to correctly estimate the translation,
for this reason the reference frame is kept fixed as we progress through the video.
Eventually, if the transformation is no longer able to match enough points, the reference frame is updated.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>bin_size</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Before calculatin the mode, optiocal flow is bucketized into bins of this size.</p></td>
          <td>
                <code>0.2</code>
          </td>
        </tr>
        <tr>
          <td><code>proportion_points_used_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Proportion of points that must be matched, otherwise the reference frame must be updated.</p></td>
          <td>
                <code>0.9</code>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>norfair/camera_motion.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TranslationTransformationGetter</span><span class="p">(</span><span class="n">TransformationGetter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates TranslationTransformation between points.</span>

<span class="sd">    The camera movement is calculated as the mode of optical flow between the previous reference frame</span>
<span class="sd">    and the current.</span>

<span class="sd">    Comparing consecutive frames can make differences too small to correctly estimate the translation,</span>
<span class="sd">    for this reason the reference frame is kept fixed as we progress through the video.</span>
<span class="sd">    Eventually, if the transformation is no longer able to match enough points, the reference frame is updated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bin_size : float</span>
<span class="sd">        Before calculatin the mode, optiocal flow is bucketized into bins of this size.</span>
<span class="sd">    proportion_points_used_threshold: float</span>
<span class="sd">        Proportion of points that must be matched, otherwise the reference frame must be updated.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">bin_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">proportion_points_used_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_size</span> <span class="o">=</span> <span class="n">bin_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_points_used_threshold</span> <span class="o">=</span> <span class="n">proportion_points_used_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">curr_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">prev_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">TranslationTransformation</span><span class="p">]:</span>
        <span class="c1"># get flow</span>
        <span class="n">flow</span> <span class="o">=</span> <span class="n">curr_pts</span> <span class="o">-</span> <span class="n">prev_pts</span>

        <span class="c1"># get mode</span>
        <span class="n">flow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">(</span><span class="n">flow</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_size</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">bin_size</span>
        <span class="n">unique_flows</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">flow</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">max_index</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">argmax</span><span class="p">()</span>

        <span class="n">proportion_points_used</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">max_index</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">prev_pts</span><span class="p">)</span>
        <span class="n">update_prvs</span> <span class="o">=</span> <span class="n">proportion_points_used</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_points_used_threshold</span>

        <span class="n">flow_mode</span> <span class="o">=</span> <span class="n">unique_flows</span><span class="p">[</span><span class="n">max_index</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">flow_mode</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">update_prvs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">flow_mode</span>

        <span class="k">return</span> <span class="n">update_prvs</span><span class="p">,</span> <span class="n">TranslationTransformation</span><span class="p">(</span><span class="n">flow_mode</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="norfair.camera_motion.HomographyTransformation">
        <code>HomographyTransformation</code>


<a class="headerlink" href="#norfair.camera_motion.HomographyTransformation" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="norfair.camera_motion.CoordinatesTransformation" href="#norfair.camera_motion.CoordinatesTransformation">CoordinatesTransformation</a></code></p>

  
      <p>Coordinate transformation beweent points using an homography</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>homography_matrix</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>The matrix representing the homography</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>


        <details class="quote">
          <summary>Source code in <code>norfair/camera_motion.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HomographyTransformation</span><span class="p">(</span><span class="n">CoordinatesTransformation</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Coordinate transformation beweent points using an homography</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    homography_matrix : np.ndarray</span>
<span class="sd">        The matrix representing the homography</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">homography_matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">homography_matrix</span> <span class="o">=</span> <span class="n">homography_matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inverse_homography_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">homography_matrix</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">abs_to_rel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">points_with_ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">points</span><span class="p">,</span> <span class="n">ones</span><span class="p">))</span>
        <span class="n">points_transformed</span> <span class="o">=</span> <span class="n">points_with_ones</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">homography_matrix</span><span class="o">.</span><span class="n">T</span>
        <span class="n">points_transformed</span> <span class="o">=</span> <span class="n">points_transformed</span> <span class="o">/</span> <span class="n">points_transformed</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">points_transformed</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">rel_to_abs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">points</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">points_with_ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">points</span><span class="p">,</span> <span class="n">ones</span><span class="p">))</span>
        <span class="n">points_transformed</span> <span class="o">=</span> <span class="n">points_with_ones</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">inverse_homography_matrix</span><span class="o">.</span><span class="n">T</span>
        <span class="n">points_transformed</span> <span class="o">=</span> <span class="n">points_transformed</span> <span class="o">/</span> <span class="n">points_transformed</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">points_transformed</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="norfair.camera_motion.HomographyTransformationGetter">
        <code>HomographyTransformationGetter</code>


<a class="headerlink" href="#norfair.camera_motion.HomographyTransformationGetter" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="norfair.camera_motion.TransformationGetter" href="#norfair.camera_motion.TransformationGetter">TransformationGetter</a></code></p>

  
      <p>Calculates HomographyTransformation between points.</p>
<p>The camera movement is represented as an homography that matches the optical flow between the previous reference frame
and the current.</p>
<p>Comparing consecutive frames can make differences too small to correctly estimate the homography, often resulting in the identity.
For this reason the reference frame is kept fixed as we progress through the video.
Eventually, if the transformation is no longer able to match enough points, the reference frame is updated.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>method</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[int], optional</code>
          </td>
          <td><p>One of openCV's method for finding homographies.
Valid options are: <code>[0, cv.RANSAC, cv.LMEDS, cv.RHO]</code>, by default <code>cv.RANSAC</code></p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>ransac_reproj_threshold</code></td>
          <td>
                <code>int, optional</code>
          </td>
          <td><p>Maximum allowed reprojection error to treat a point pair as an inlier. More info in links below.</p></td>
          <td>
                <code>3</code>
          </td>
        </tr>
        <tr>
          <td><code>max_iters</code></td>
          <td>
                <code>int, optional</code>
          </td>
          <td><p>The maximum number of RANSAC iterations.  More info in links below.</p></td>
          <td>
                <code>2000</code>
          </td>
        </tr>
        <tr>
          <td><code>confidence</code></td>
          <td>
                <code>float, optional</code>
          </td>
          <td><p>Confidence level, must be between 0 and 1. More info in links below.</p></td>
          <td>
                <code>0.995</code>
          </td>
        </tr>
        <tr>
          <td><code>proportion_points_used_threshold</code></td>
          <td>
                <code>float, optional</code>
          </td>
          <td><p>Proportion of points that must be matched, otherwise the reference frame must be updated.</p></td>
          <td>
                <code>0.9</code>
          </td>
        </tr>
    </tbody>
  </table>
      <h4 id="norfair.camera_motion.HomographyTransformationGetter--see-also">See Also<a class="headerlink" href="#norfair.camera_motion.HomographyTransformationGetter--see-also" title="Permanent link">#</a></h4>
<p><a href="https://docs.opencv.org/3.4/d9/d0c/group__calib3d.html#ga4abc2ece9fab9398f2e560d53c8c9780">opencv.findHomography</a></p>


        <details class="quote">
          <summary>Source code in <code>norfair/camera_motion.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">HomographyTransformationGetter</span><span class="p">(</span><span class="n">TransformationGetter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates HomographyTransformation between points.</span>

<span class="sd">    The camera movement is represented as an homography that matches the optical flow between the previous reference frame</span>
<span class="sd">    and the current.</span>

<span class="sd">    Comparing consecutive frames can make differences too small to correctly estimate the homography, often resulting in the identity.</span>
<span class="sd">    For this reason the reference frame is kept fixed as we progress through the video.</span>
<span class="sd">    Eventually, if the transformation is no longer able to match enough points, the reference frame is updated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    method : Optional[int], optional</span>
<span class="sd">        One of openCV&#39;s method for finding homographies.</span>
<span class="sd">        Valid options are: `[0, cv.RANSAC, cv.LMEDS, cv.RHO]`, by default `cv.RANSAC`</span>
<span class="sd">    ransac_reproj_threshold : int, optional</span>
<span class="sd">        Maximum allowed reprojection error to treat a point pair as an inlier. More info in links below.</span>
<span class="sd">    max_iters : int, optional</span>
<span class="sd">        The maximum number of RANSAC iterations.  More info in links below.</span>
<span class="sd">    confidence : float, optional</span>
<span class="sd">        Confidence level, must be between 0 and 1. More info in links below.</span>
<span class="sd">    proportion_points_used_threshold : float, optional</span>
<span class="sd">        Proportion of points that must be matched, otherwise the reference frame must be updated.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    [opencv.findHomography](https://docs.opencv.org/3.4/d9/d0c/group__calib3d.html#ga4abc2ece9fab9398f2e560d53c8c9780)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ransac_reproj_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">max_iters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="n">confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.995</span><span class="p">,</span>
        <span class="n">proportion_points_used_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">RANSAC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ransac_reproj_threshold</span> <span class="o">=</span> <span class="n">ransac_reproj_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_iters</span> <span class="o">=</span> <span class="n">max_iters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confidence</span> <span class="o">=</span> <span class="n">confidence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proportion_points_used_threshold</span> <span class="o">=</span> <span class="n">proportion_points_used_threshold</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">curr_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">prev_pts</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">HomographyTransformation</span><span class="p">]:</span>
        <span class="n">homography_matrix</span><span class="p">,</span> <span class="n">points_used</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">findHomography</span><span class="p">(</span>
            <span class="n">prev_pts</span><span class="p">,</span>
            <span class="n">curr_pts</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
            <span class="n">ransacReprojThreshold</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ransac_reproj_threshold</span><span class="p">,</span>
            <span class="n">maxIters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_iters</span><span class="p">,</span>
            <span class="n">confidence</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">confidence</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">proportion_points_used</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">points_used</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">points_used</span><span class="p">)</span>

        <span class="n">update_prvs</span> <span class="o">=</span> <span class="n">proportion_points_used</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">proportion_points_used_threshold</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">homography_matrix</span> <span class="o">=</span> <span class="n">homography_matrix</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">update_prvs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">homography_matrix</span>

        <span class="k">return</span> <span class="n">update_prvs</span><span class="p">,</span> <span class="n">HomographyTransformation</span><span class="p">(</span><span class="n">homography_matrix</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h2 class="doc doc-heading" id="norfair.camera_motion.MotionEstimator">
        <code>MotionEstimator</code>


<a class="headerlink" href="#norfair.camera_motion.MotionEstimator" title="Permanent link">#</a></h2>


  <div class="doc doc-contents ">

  
      <p>Estimator of the motion of the camera.</p>
<p>Uses optical flow to estimate the motion of the camera from frame to frame.
The optical flow is calculated on a sample of strong points (corners).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>max_points</code></td>
          <td>
                <code>int, optional</code>
          </td>
          <td><p>Maximum amount of points sampled.
More points make the estimation process slower but more precise</p></td>
          <td>
                <code>200</code>
          </td>
        </tr>
        <tr>
          <td><code>min_distance</code></td>
          <td>
                <code>int, optional</code>
          </td>
          <td><p>Minimum distance between the sample points.</p></td>
          <td>
                <code>15</code>
          </td>
        </tr>
        <tr>
          <td><code>block_size</code></td>
          <td>
                <code>int, optional</code>
          </td>
          <td><p>Size of an average block when finding the corners. More info in links below.</p></td>
          <td>
                <code>3</code>
          </td>
        </tr>
        <tr>
          <td><code>transformations_getter</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="norfair.camera_motion.TransformationGetter" href="#norfair.camera_motion.TransformationGetter">TransformationGetter</a>, optional</code>
          </td>
          <td><p>An instance of TransformationGetter. By default <a class="autorefs autorefs-internal" href="#norfair.camera_motion.HomographyTransformationGetter"><code>HomographyTransformationGetter</code></a></p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>draw_flow</code></td>
          <td>
                <code>bool, optional</code>
          </td>
          <td><p>Draws the optical flow on the frame for debugging.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>flow_color</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Tuple">Tuple</span>[int, int, int]], optional</code>
          </td>
          <td><p>Color of the drawing, by default blue.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>quality_level</code></td>
          <td>
                <code>float, optional</code>
          </td>
          <td><p>Parameter characterizing the minimal accepted quality of image corners.</p></td>
          <td>
                <code>0.01</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">norfair</span> <span class="kn">import</span> <span class="n">Tracker</span><span class="p">,</span> <span class="n">Video</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">norfair.camera_motion</span> <span class="n">MotionEstimator</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">video</span> <span class="o">=</span> <span class="n">Video</span><span class="p">(</span><span class="s2">&quot;video.mp4&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">tracker</span> <span class="o">=</span> <span class="n">Tracker</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">motion_estimator</span> <span class="o">=</span> <span class="n">MotionEstimator</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">video</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">detections</span> <span class="o">=</span> <span class="n">get_detections</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>  <span class="c1"># runs detector and returns Detections</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">coord_transformation</span> <span class="o">=</span> <span class="n">motion_estimator</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">tracked_objects</span> <span class="o">=</span> <span class="n">tracker</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">detections</span><span class="p">,</span> <span class="n">coord_transformations</span><span class="o">=</span><span class="n">coord_transformation</span><span class="p">)</span>
</code></pre></div>
      <h4 id="norfair.camera_motion.MotionEstimator--see-also">See Also<a class="headerlink" href="#norfair.camera_motion.MotionEstimator--see-also" title="Permanent link">#</a></h4>
<p>For more infor on how the points are sampled: <a href="https://docs.opencv.org/3.4/dd/d1a/group__imgproc__feature.html#ga1d6bb77486c8f92d79c8793ad995d541">OpenCV.goodFeaturesToTrack</a></p>


        <details class="quote">
          <summary>Source code in <code>norfair/camera_motion.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MotionEstimator</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimator of the motion of the camera.</span>

<span class="sd">    Uses optical flow to estimate the motion of the camera from frame to frame.</span>
<span class="sd">    The optical flow is calculated on a sample of strong points (corners).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    max_points : int, optional</span>
<span class="sd">        Maximum amount of points sampled.</span>
<span class="sd">        More points make the estimation process slower but more precise</span>
<span class="sd">    min_distance : int, optional</span>
<span class="sd">        Minimum distance between the sample points.</span>
<span class="sd">    block_size : int, optional</span>
<span class="sd">        Size of an average block when finding the corners. More info in links below.</span>
<span class="sd">    transformations_getter : TransformationGetter, optional</span>
<span class="sd">        An instance of TransformationGetter. By default [`HomographyTransformationGetter`][norfair.camera_motion.HomographyTransformationGetter]</span>
<span class="sd">    draw_flow : bool, optional</span>
<span class="sd">        Draws the optical flow on the frame for debugging.</span>
<span class="sd">    flow_color : Optional[Tuple[int, int, int]], optional</span>
<span class="sd">        Color of the drawing, by default blue.</span>
<span class="sd">    quality_level : float, optional</span>
<span class="sd">        Parameter characterizing the minimal accepted quality of image corners.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from norfair import Tracker, Video</span>
<span class="sd">    &gt;&gt;&gt; from norfair.camera_motion MotionEstimator</span>
<span class="sd">    &gt;&gt;&gt; video = Video(&quot;video.mp4&quot;)</span>
<span class="sd">    &gt;&gt;&gt; tracker = Tracker(...)</span>
<span class="sd">    &gt;&gt;&gt; motion_estimator = MotionEstimator()</span>
<span class="sd">    &gt;&gt;&gt; for frame in video:</span>
<span class="sd">    &gt;&gt;&gt;    detections = get_detections(frame)  # runs detector and returns Detections</span>
<span class="sd">    &gt;&gt;&gt;    coord_transformation = motion_estimator.update(frame)</span>
<span class="sd">    &gt;&gt;&gt;    tracked_objects = tracker.update(detections, coord_transformations=coord_transformation)</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    For more infor on how the points are sampled: [OpenCV.goodFeaturesToTrack](https://docs.opencv.org/3.4/dd/d1a/group__imgproc__feature.html#ga1d6bb77486c8f92d79c8793ad995d541)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">max_points</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
        <span class="n">min_distance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
        <span class="n">block_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">transformations_getter</span><span class="p">:</span> <span class="n">TransformationGetter</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">draw_flow</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">flow_color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">quality_level</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">max_points</span> <span class="o">=</span> <span class="n">max_points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_distance</span> <span class="o">=</span> <span class="n">min_distance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">=</span> <span class="n">block_size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">draw_flow</span> <span class="o">=</span> <span class="n">draw_flow</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_flow</span> <span class="ow">and</span> <span class="n">flow_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flow_color</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flow_color</span> <span class="o">=</span> <span class="n">flow_color</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gray_prvs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_pts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">transformations_getter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">transformations_getter</span> <span class="o">=</span> <span class="n">HomographyTransformationGetter</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">transformations_getter</span> <span class="o">=</span> <span class="n">transformations_getter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gray_next</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quality_level</span> <span class="o">=</span> <span class="n">quality_level</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CoordinatesTransformation</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate camera motion for each frame</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : np.ndarray</span>
<span class="sd">            The frame.</span>
<span class="sd">        mask : np.ndarray, optional</span>
<span class="sd">            An optional mask to avoid areas of the frame when sampling the corner.</span>
<span class="sd">            Must be an array of shape `(frame.shape[0], frame.shape[1])`, dtype same as frame,</span>
<span class="sd">            and values in {0, 1}.</span>

<span class="sd">            In general, the estimation will work best when it samples many points from the background;</span>
<span class="sd">            with that intention, this parameters is usefull for masking out the detections/tracked objects,</span>
<span class="sd">            forcing the MotionEstimator ignore the moving objects.</span>
<span class="sd">            Can be used to mask static areas of the image, such as score overlays in sport transmisions or</span>
<span class="sd">            timestamps in security cameras.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CoordinatesTransformation</span>
<span class="sd">            The CoordinatesTransformation that can transform coordinates on this frame to absolute coordinates</span>
<span class="sd">            or vice versa.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gray_next</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gray_prvs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gray_prvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gray_next</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_mask</span> <span class="o">=</span> <span class="n">mask</span>

        <span class="n">curr_pts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_pts</span> <span class="o">=</span> <span class="n">_get_sparse_flow</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gray_next</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gray_prvs</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_pts</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_points</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_distance</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_mask</span><span class="p">,</span>
            <span class="n">quality_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quality_level</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_flow</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">curr_pts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_pts</span><span class="p">):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">curr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
                <span class="n">p</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prev</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_color</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">update_prvs</span><span class="p">,</span> <span class="n">coord_transformations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformations_getter</span><span class="p">(</span>
            <span class="n">curr_pts</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_pts</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">update_prvs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gray_prvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gray_next</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_pts</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prev_mask</span> <span class="o">=</span> <span class="n">mask</span>

        <span class="k">return</span> <span class="n">coord_transformations</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h3 class="doc doc-heading" id="norfair.camera_motion.MotionEstimator.update">
<code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a class="headerlink" href="#norfair.camera_motion.MotionEstimator.update" title="Permanent link">#</a></h3>


  <div class="doc doc-contents ">
  
      <p>Estimate camera motion for each frame</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>frame</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td><p>The frame.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>mask</code></td>
          <td>
                <code><span title="numpy">np</span>.<span title="numpy.ndarray">ndarray</span>, optional</code>
          </td>
          <td><p>An optional mask to avoid areas of the frame when sampling the corner.
Must be an array of shape <code>(frame.shape[0], frame.shape[1])</code>, dtype same as frame,
and values in {0, 1}.</p>
<p>In general, the estimation will work best when it samples many points from the background;
with that intention, this parameters is usefull for masking out the detections/tracked objects,
forcing the MotionEstimator ignore the moving objects.
Can be used to mask static areas of the image, such as score overlays in sport transmisions or
timestamps in security cameras.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><a class="autorefs autorefs-internal" title="norfair.camera_motion.CoordinatesTransformation" href="#norfair.camera_motion.CoordinatesTransformation">CoordinatesTransformation</a></code>
          </td>
          <td><p>The CoordinatesTransformation that can transform coordinates on this frame to absolute coordinates
or vice versa.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>norfair/camera_motion.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CoordinatesTransformation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Estimate camera motion for each frame</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frame : np.ndarray</span>
<span class="sd">        The frame.</span>
<span class="sd">    mask : np.ndarray, optional</span>
<span class="sd">        An optional mask to avoid areas of the frame when sampling the corner.</span>
<span class="sd">        Must be an array of shape `(frame.shape[0], frame.shape[1])`, dtype same as frame,</span>
<span class="sd">        and values in {0, 1}.</span>

<span class="sd">        In general, the estimation will work best when it samples many points from the background;</span>
<span class="sd">        with that intention, this parameters is usefull for masking out the detections/tracked objects,</span>
<span class="sd">        forcing the MotionEstimator ignore the moving objects.</span>
<span class="sd">        Can be used to mask static areas of the image, such as score overlays in sport transmisions or</span>
<span class="sd">        timestamps in security cameras.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    CoordinatesTransformation</span>
<span class="sd">        The CoordinatesTransformation that can transform coordinates on this frame to absolute coordinates</span>
<span class="sd">        or vice versa.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gray_next</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gray_prvs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gray_prvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gray_next</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_mask</span> <span class="o">=</span> <span class="n">mask</span>

    <span class="n">curr_pts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_pts</span> <span class="o">=</span> <span class="n">_get_sparse_flow</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gray_next</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gray_prvs</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_pts</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_points</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_distance</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_mask</span><span class="p">,</span>
        <span class="n">quality_level</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">quality_level</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_flow</span><span class="p">:</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="n">prev</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">curr_pts</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">prev_pts</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">curr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
            <span class="n">p</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">prev</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_color</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">flow_color</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">update_prvs</span><span class="p">,</span> <span class="n">coord_transformations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformations_getter</span><span class="p">(</span>
        <span class="n">curr_pts</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_pts</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">update_prvs</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gray_prvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gray_next</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_pts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prev_mask</span> <span class="o">=</span> <span class="n">mask</span>

    <span class="k">return</span> <span class="n">coord_transformations</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../distances/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Distances" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Distances
            </div>
          </div>
        </a>
      
      
        
        <a href="../filter/" class="md-footer__link md-footer__link--next" aria-label="Next: Filter" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Filter
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.tracking", "navigation.sections"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
        <script src="../../js/math.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>